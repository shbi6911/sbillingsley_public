
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Project2_main</title><meta name="generator" content="MATLAB 9.12"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2022-11-16"><meta name="DC.source" content="Project2_main.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">ASEN 2012: Project 2: Bottle Rocket Trajectory</a></li><li><a href="#2">plot results vs. verification case</a></li><li><a href="#3">Subfunction rocketEOM. This is the subfunction called by ODE45.</a></li><li><a href="#4">Subfunction getConst which sets up the constants needed to solve this problem.</a></li></ul></div><h2 id="1">ASEN 2012: Project 2: Bottle Rocket Trajectory</h2><p>by:               [Shane Billingsley] SID:              [110231742] date created:     [11/11/22] last modified:    [11/16/22]</p><p>PURPOSE: The purpose of this script is to integrate the trajectory of a water bottle rocket, using Newton's Laws of Motion, and equations governing the pressure and volume of air within the rocket.</p><p>To accomplish this, the script defines a function to feed into ode45 for integration, and then plots the integrated data vs. a given verification case.</p><p>INPUTS: The code requires a verification case for comparison.  All other input values are set using the getConst function. OUTPUTS: The code outputs plots of an integrated bottle rocket trajectory, defined in terms of position and velocity in the x and z directions.  Rocket thrust vs. time is also plotted. ASSUMPTIONS: We assume that atmospheric conditions at launch can be treated as constant (i.e. the rocket does not go high enough for these values to change.) We assume that forces in the y-direction are negligible for this calculation. We assume that the drag coefficient of the rocket is constant (i.e. it does not change with orientation of the rocket.) We assume that the expansion of air in the rocket, and its escape through the throat, is isentropic.</p><pre class="codeinput"><span class="comment">% housekeeping</span>
clc;
clear <span class="string">all</span>;

<span class="comment">% import comparison data</span>
load (<span class="string">"project2verification.mat"</span>);

<span class="comment">%define initial conditions for integration</span>
const = getConst(); <span class="comment">%define constants for main script</span>
tspan = [0 5];      <span class="comment">%set time span for integration</span>
IC = [const.p0;const.v0;const.V0;const.m_water;const.m_air]; <span class="comment">%set initial conditions</span>
<span class="comment">%state vector contains 9 variables [position(x,y,z),velocity(x,y,z),air</span>
<span class="comment">%volume, water mass, air mass]</span>
opts = odeset(<span class="string">'RelTol'</span>,1e-6,<span class="string">'AbsTol'</span>,1e-9);  <span class="comment">%set tolerances for ode45</span>

<span class="comment">%integrate trajectory using ode45, drumroll please</span>
[t,y] = ode45(@(t,X) rocketEOM(t,X),tspan,IC,opts);

<span class="comment">% extract additional data from rocketEOM function</span>
<span class="comment">% most importantly thrust, but also other values for debugging purposes</span>
data = zeros(length(t),4);
<span class="keyword">for</span> i = 1:length(t)
    [~,data(i,:)]=rocketEOM(t(i),y(i,:));
<span class="keyword">end</span>
</pre><h2 id="2">plot results vs. verification case</h2><pre class="codeinput">figure(1);                                  <span class="comment">% plot x-position</span>
hold <span class="string">on</span>; grid <span class="string">on</span>;
plot(t,y(:,1),<span class="string">"LineWidth"</span>,2);
scatter(verification.time,verification.distance,5,<span class="string">"red"</span>,<span class="string">"filled"</span>,<span class="string">"o"</span>);
title (<span class="string">"Bottle Rocket Trajectory (X)"</span>);
xlabel (<span class="string">"Time (s)"</span>);
ylabel (<span class="string">"X-Position (m)"</span>);
legend (<span class="string">"My Data"</span>,<span class="string">"Verification"</span>);
hold <span class="string">off</span>;

<span class="comment">% figure(2);                                % plot y-position</span>
<span class="comment">% hold on; grid on;</span>
<span class="comment">% plot(t,y(:,2),"LineWidth",2);</span>
<span class="comment">% title ("Bottle Rocket Trajectory (Y)");</span>
<span class="comment">% xlabel ("Time (s)");</span>
<span class="comment">% ylabel ("Y-Position (m)");</span>
<span class="comment">% hold off;</span>

figure(3);                                  <span class="comment">% plot z-position</span>
hold <span class="string">on</span>; grid <span class="string">on</span>;
plot(t,y(:,3),<span class="string">"LineWidth"</span>,2);
scatter(verification.time,verification.height,5,<span class="string">"red"</span>,<span class="string">"filled"</span>,<span class="string">"o"</span>);
title (<span class="string">"Bottle Rocket Trajectory (Z)"</span>);
xlabel (<span class="string">"Time (s)"</span>);
ylabel (<span class="string">"Z-Position (m)"</span>);
xlim([0 4]);
legend (<span class="string">"My Data"</span>,<span class="string">"Verification"</span>);
hold <span class="string">off</span>;

figure(4);                                  <span class="comment">% plot x-velocity</span>
hold <span class="string">on</span>; grid <span class="string">on</span>;
plot(t,y(:,4),<span class="string">"LineWidth"</span>,2);
scatter(verification.time,verification.xVelocity,5,<span class="string">"red"</span>,<span class="string">"filled"</span>,<span class="string">"o"</span>);
title (<span class="string">"Bottle Rocket Velocity (X)"</span>);
xlabel (<span class="string">"Time (s)"</span>);
ylabel (<span class="string">"X-Velocity (m/s)"</span>);
xlim([0 4]);
legend (<span class="string">"My Data"</span>,<span class="string">"Verification"</span>);
hold <span class="string">off</span>;

<span class="comment">% figure(5);                                % plot y-velocity</span>
<span class="comment">% hold on; grid on;</span>
<span class="comment">% plot(t,y(:,5),"LineWidth",2);</span>
<span class="comment">% title ("Bottle Rocket Velocity (Y)");</span>
<span class="comment">% xlabel ("Time (s)");</span>
<span class="comment">% ylabel ("Y-Velocity (m/s)");</span>
<span class="comment">% hold off;</span>

figure(6);                                  <span class="comment">% plot z-velocity</span>
hold <span class="string">on</span>; grid <span class="string">on</span>;
plot(t,y(:,6),<span class="string">"LineWidth"</span>,2);
scatter(verification.time,verification.zVelocity,5,<span class="string">"red"</span>,<span class="string">"filled"</span>,<span class="string">"o"</span>);
title (<span class="string">"Bottle Rocket Velocity (Z)"</span>);
xlabel (<span class="string">"Time (s)"</span>);
ylabel (<span class="string">"Z-Velocity (m/s)"</span>);
xlim([0 4]);
legend (<span class="string">"My Data"</span>,<span class="string">"Verification"</span>);
hold <span class="string">off</span>;

figure(7);                                  <span class="comment">% plot air volume</span>
hold <span class="string">on</span>; grid <span class="string">on</span>;
plot(t,y(:,7),<span class="string">"LineWidth"</span>,2);
scatter(verification.time,verification.airVolume,5,<span class="string">"red"</span>,<span class="string">"filled"</span>,<span class="string">"o"</span>);
title (<span class="string">"Bottle Rocket Air Volume (m^3)"</span>);
xlabel (<span class="string">"Time (s)"</span>);
ylabel (<span class="string">"Volume (kg/m^3)"</span>);
xlim([0 0.3]);
legend (<span class="string">"My Data"</span>,<span class="string">"Verification"</span>);
hold <span class="string">off</span>;

figure(9);                                  <span class="comment">% plot thrust</span>
hold <span class="string">on</span>; grid <span class="string">on</span>;
plot(t,data(:,1),<span class="string">"LineWidth"</span>,2);
scatter(verification.time,verification.thrust,5,<span class="string">"red"</span>,<span class="string">"filled"</span>,<span class="string">"o"</span>);
title (<span class="string">"Bottle Rocket Thrust"</span>);
xlabel (<span class="string">"Time (s)"</span>);
ylabel (<span class="string">"Thrust (N)"</span>);
xlim([0 0.3]);
legend (<span class="string">"My Data"</span>,<span class="string">"Verification"</span>);
hold <span class="string">off</span>;

<span class="comment">% figure(10);                                 % plot pressure</span>
<span class="comment">% hold on; grid on;</span>
<span class="comment">% scatter(t,data(:,2),5,"red","filled","o");</span>
<span class="comment">% title ("Bottle Rocket Air Pressure");</span>
<span class="comment">% xlabel ("Time (s)");</span>
<span class="comment">% ylabel ("Pressure (Pa)");</span>
<span class="comment">% xlim([0 0.3]);</span>
<span class="comment">% hold off;</span>

<span class="comment">%output final comparison values to the command window</span>
disp(<span class="string">"Max Altitude (My Data)"</span>);
disp(max(y(:,3)));
disp(<span class="string">"Max Altitude (Verification)"</span>);
disp(max(verification.height))
disp (<span class="string">"Max Distance (My Data)"</span>);
disp (max(y(:,1)));
disp (<span class="string">"Max Distance (Verification)"</span>);
disp (max(verification.distance));
</pre><pre class="codeoutput">Max Altitude (My Data)
   16.9310

Max Altitude (Verification)
   17.3709

Max Distance (My Data)
   60.4677

Max Distance (Verification)
   60.4487

</pre><img vspace="5" hspace="5" src="Project2_main_01.png" alt=""> <img vspace="5" hspace="5" src="Project2_main_02.png" alt=""> <img vspace="5" hspace="5" src="Project2_main_03.png" alt=""> <img vspace="5" hspace="5" src="Project2_main_04.png" alt=""> <img vspace="5" hspace="5" src="Project2_main_05.png" alt=""> <img vspace="5" hspace="5" src="Project2_main_06.png" alt=""> <h2 id="3">Subfunction rocketEOM. This is the subfunction called by ODE45.</h2><pre class="codeinput"><span class="keyword">function</span> [dX,data] = rocketEOM(t,X)
<span class="comment">%</span>
<span class="comment">% Inputs:   t = anonymous time variable</span>
<span class="comment">%           X = anonymous state vector containing</span>
<span class="comment">%             = [p_x;p_y;p_z;v_x;v_y;v_z;air volume;mass of water, mass of air]</span>
<span class="comment">%</span>
<span class="comment">% Outputs: dX = derivative state vector containing</span>
<span class="comment">%             = [dp/dx;dp/dy;dp/dz;dv/dx;dv/dy;dv/dz;dV/dt;dm_w/dt;dm_a/dt]</span>
<span class="comment">%</span>
<span class="comment">% Methodology: function used for integrating the flight of a water bottle</span>
<span class="comment">% rocket</span>
<span class="comment">%</span>

<span class="comment">% Extract state vector</span>
p = [X(1);X(2);X(3)];   <span class="comment">% From the variable X coming in, extract the indices</span>
                        <span class="comment">% corresponding to position</span>
v = [X(4);X(5);X(6)];   <span class="comment">% From the variable X coming in, extract the indices</span>
                        <span class="comment">% corresponding to velocity</span>
V = X(7);   <span class="comment">% Extract the index corresponding to volume of air</span>
m_w = X(8);   <span class="comment">% Extract the index corresponding to mass of water</span>
m_a = X(9);   <span class="comment">% Extract the index corresponding to mass of air</span>


const = getConst();     <span class="comment">%define constants within the function</span>

<span class="comment">% set heading vector and adjust for wind</span>
v_rel_vec = v-const.w0;
v_rel_mag = norm(v_rel_vec);
<span class="keyword">if</span> norm(p) &lt;= const.Ls          <span class="comment">%rocket still on launch stand</span>
    h = const.h0;
<span class="keyword">else</span>
    h = v_rel_vec/v_rel_mag;    <span class="comment">%heading vector free to change      %EQ 2</span>
<span class="keyword">end</span>

<span class="comment">%determine air pressure at two different phases of flight</span>
<span class="keyword">if</span> V &lt;= const.V     <span class="comment">% before water is exhausted</span>
    P = const.P0*((const.V0/V)^const.gamma);                        <span class="comment">%EQ 5</span>
<span class="keyword">else</span>                <span class="comment">% after water is exhausted</span>
    P = const.P_end*((m_a)/const.m_air)^const.gamma;                <span class="comment">%EQ 16</span>
<span class="keyword">end</span>

<span class="comment">% Determine the phase of flight of the system to write the proper equations of motion</span>
<span class="comment">% using if statements to check the relevant state variables</span>

<span class="keyword">if</span> V &lt;= const.V  <span class="comment">% check that volume of air is less than volume of the</span>
                  <span class="comment">% bottle rocket</span>
    <span class="comment">% phase 1: expelling water</span>

    <span class="comment">% Calculate forces for Newton's Second Law</span>
    fGrav = [0;0;-((m_w+m_a+const.m_dry)*const.g0)];                <span class="comment">%EQ 1</span>
    fThrust = h*(2*const.C_dis*const.At*(P-const.Pa));              <span class="comment">%EQ 9</span>
    fDrag = -h*(0.5*const.Ac*const.C_drag*const.rho_air*(v_rel_mag^2)); <span class="comment">%EQ 4</span>
    <span class="comment">% define change in mass</span>
    dm_wdt = -(const.C_dis*const.At*sqrt(2*const.rho_water*(P-const.Pa))); <span class="comment">%EQ 6</span>
    dm_adt = 0;
    <span class="comment">% define change in volume</span>
    dVdt = const.C_dis*const.At*<span class="keyword">...</span><span class="comment">                                 %EQ 10</span>
        sqrt((2/const.rho_water)*(const.P0*((const.V0/V)^const.gamma)-const.Pa));
    <span class="comment">% define values for debugging purposes</span>
    M_e = 0;
    flag = 10;

<span class="keyword">elseif</span> P &gt;= const.Pa <span class="comment">% check that air pressure is greater than ambient</span>
                     <span class="comment">% air pressure</span>
    <span class="comment">% phase 2: expelling air</span>

    <span class="comment">% Calculate forces for Newton's Second Law</span>
    fGrav = [0;0;-((m_w+m_a+const.m_dry)*const.g0)];                <span class="comment">%EQ 1</span>
    fDrag = -h*(0.5*const.Ac*const.C_drag*const.rho_air*(v_rel_mag^2)); <span class="comment">%EQ 4</span>

    <span class="comment">%define critical pressure</span>
    P_crit = P*((2/(const.gamma+1))^(const.gamma/(const.gamma-1))); <span class="comment">%EQ 17</span>
    <span class="comment">% Check for choked flow through the throat</span>
    <span class="keyword">if</span> P_crit &gt; const.Pa     <span class="comment">%choked flow</span>
        rho = m_a/const.V;  <span class="comment">%find current air density in bottle     %EQ 18</span>
        T = P/(rho*const.R_air);    <span class="comment">%find current temperature in bottle %EQ 18</span>
        P_e = P_crit;    <span class="comment">%define pressure at the exit               %EQ 18</span>
        M_e = 1;         <span class="comment">%define Mach number at the exit</span>
        T_e = (2/(const.gamma+1)*T); <span class="comment">%define temperature at the exit    %EQ 18</span>
        rho_e = P_e/(const.R_air*T_e);  <span class="comment">%define density at the exit %EQ 18</span>
        V_e = M_e*sqrt(const.gamma*const.R_air*T_e); <span class="comment">%define exit velocity %EQ 18</span>
        <span class="comment">% define values for debugging purposes</span>
        flag = 21;

    <span class="keyword">else</span>                    <span class="comment">%not choked flow</span>
        rho = m_a/const.V;  <span class="comment">%find current air density in bottle     %EQ 19</span>
        T = P/(rho*const.R_air);    <span class="comment">%find current temperature in bottle %EQ 19</span>
        P_e = const.Pa;    <span class="comment">%define pressure at the exit             %EQ 19</span>
                           <span class="comment">%define Mach number at the exit</span>
        M_e = sqrt((((P/const.Pa)^((const.gamma-1)/const.gamma))-1)*<span class="keyword">...</span>
            (2/(const.gamma-1)));                                   <span class="comment">%EQ 19</span>
                           <span class="comment">%define temperature at the exit</span>
        T_e = T/((((const.gamma-1)/2)*M_e^2)+1);                    <span class="comment">%EQ 19</span>
        rho_e = const.Pa/(const.R_air*T_e);  <span class="comment">%define density at the exit %EQ 19</span>
        V_e = M_e*sqrt(const.gamma*const.R_air*T_e); <span class="comment">%define exit velocity %EQ 19</span>
        <span class="comment">% define values for debugging purposes</span>
        flag = 22;
    <span class="keyword">end</span>
    <span class="comment">% define change in mass</span>
    dm_adt = -const.C_dis*rho_e*const.At*V_e;                        <span class="comment">%EQ 21</span>
    dm_wdt = 0;

    fThrust = h*(((-dm_adt)*V_e)+((P_e-const.Pa)*const.At));        <span class="comment">%EQ 20</span>

    <span class="comment">% define change in volume</span>
    dVdt = 0;

<span class="keyword">elseif</span> p(3) &gt;= 0   <span class="comment">% check that the rocket is above the ground</span>
    <span class="comment">% phase 3: ballistic phase</span>

    <span class="comment">% Calculate forces for Newton's Second Law</span>
    fGrav = [0;0;-((m_w+m_a+const.m_dry)*const.g0)];                <span class="comment">%EQ 1</span>
    fThrust = [0;0;0];
    fDrag = -h*(0.5*const.Ac*const.C_drag*const.rho_air*(v_rel_mag^2)); <span class="comment">%EQ 4</span>

    <span class="comment">% define change in mass</span>
    dm_wdt = 0;
    dm_adt = 0;

    <span class="comment">% define change in volume</span>
    dVdt = 0;

    <span class="comment">% define values for debugging purposes</span>
    M_e = 0;
    flag = 30;

<span class="keyword">else</span>                <span class="comment">% after rocket has landed, stop any changes</span>
    fThrust = [0;0;0];
    fGrav = [0;0;0];
    fDrag = [0;0;0];
    v = [0;0;0];
    dm_adt = 0;
    dm_wdt = 0;
    dVdt = 0;
    M_e = 0;
    flag = 40;
<span class="keyword">end</span>

<span class="comment">% expression for net force and acceleration per Newton's Second Law</span>
fnet = fThrust + fGrav + fDrag;                                  <span class="comment">%EQ 1</span>
<span class="comment">%forces are signed properly in previous steps</span>

a = fnet/(m_a+m_w+const.m_dry); <span class="comment">% calculate acceleration</span>

dX = [v;a;dVdt;dm_wdt;dm_adt]; <span class="comment">%create output derivative vector using changed variables</span>
data = [norm(fThrust),P,M_e,flag]; <span class="comment">%output thrust data and debugging values</span>
<span class="keyword">end</span>
</pre><h2 id="4">Subfunction getConst which sets up the constants needed to solve this problem.</h2><pre class="codeinput"><span class="keyword">function</span> const = getConst()
<span class="comment">%</span>
<span class="comment">% Inputs:  N/A</span>
<span class="comment">%</span>
<span class="comment">% Outputs: const = structure containing initial conditions, physical</span>
<span class="comment">% constants, given rocket characteristics, and other values not changing</span>
<span class="comment">% with time.</span>
<span class="comment">%</span>
<span class="comment">% Methodology: function used to define a constant structure for ode45 integration</span>
<span class="comment">%</span>

<span class="comment">% initial conditions</span>
const.p0 = [0;0;0.25]; <span class="comment">% initial position vector (m)</span>
const.v0 = [0;0;0]; <span class="comment">% initial velocity vector (m/s)</span>
const.w0 = [0;0;0]; <span class="comment">% initial wind vector (m/s)</span>
const.h0 = [sqrt(2)/2;0;sqrt(2)/2]; <span class="comment">% initial heading vector (m)</span>
const.T0 =  300; <span class="comment">% initial temperature (K)</span>
const.P0 = 344642.86+83403.57; <span class="comment">% gage pressure+ambient pressure (Pa) (N/m^2)</span>
const.Vw = 0.001; <span class="comment">% initial volume of water (m^3)</span>
const.Ls = 0.5; <span class="comment">% length of launch stand (m)</span>

<span class="comment">% properties of the bottle rocket</span>
const.m_dry =  0.15; <span class="comment">% dry mass of bottle rocket (kg)</span>
const.d =  0.105; <span class="comment">% diameter of the bottle rocket (m)</span>
const.d_t = 0.021; <span class="comment">% diameter of the rocket throat (m)</span>
const.V = 0.002; <span class="comment">% volume of empty bottle rocket (m^3)</span>
const.C_dis = 0.8; <span class="comment">% discharge coefficient of the rocket</span>
const.C_drag = 0.5; <span class="comment">% drag coefficient of the rocket</span>

<span class="comment">% physical constants</span>
const.g0 = 9.81; <span class="comment">% gravitational acceleration (m/s^2)</span>
const.Pa = 83403.57; <span class="comment">% ambient air pressure at launch altitude (Pa) (N/m^2)</span>
const.rho_air = 0.961; <span class="comment">% density of ambient air at launch altitude (kg/m^3)</span>
const.rho_water = 1000; <span class="comment">% density of water (kg/m^3)</span>
const.gamma = 1.4; <span class="comment">% ratio of specific heats for air</span>
const.R_air = 287; <span class="comment">% R-value for air (J/kg*K)</span>

<span class="comment">% some derived properties</span>
const.V0 = const.V-const.Vw; <span class="comment">%initial volume of air</span>
const.m_air = <span class="keyword">...</span><span class="comment">   % initial mass of air in the bottle rocket (kg)</span>
    ((const.P0)*const.V0)/(const.R_air*const.T0);
const.m_water = <span class="keyword">...</span><span class="comment"> % initial mass of water in the bottle rocket (kg)</span>
    (const.rho_water*const.Vw);
const.m_wet = <span class="keyword">...</span><span class="comment">   % initial wet mass of the bottle rocket (kg)</span>
    const.m_dry + const.m_air + const.m_water;                      <span class="comment">%EQ 12</span>
const.P_end = <span class="keyword">...</span><span class="comment">   % air pressure when water is exhausted (Pa) (N/m^2)</span>
    const.P0*((const.V0/const.V)^const.gamma);                      <span class="comment">%EQ 14</span>
const.T_end = <span class="keyword">...</span><span class="comment">   % air temperature when water is exhausted (K)</span>
    const.T0*((const.V0/const.V)^(const.gamma-1));                  <span class="comment">%EQ 15</span>
const.Ac = pi * const.d^2 * (1/4);  <span class="comment">% cross-sectional area of rocket (m^2)</span>
const.At = pi * const.d_t^2 * (1/4); <span class="comment">%cross-sectional area of the throat (m^2)</span>

<span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2022a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% ASEN 2012: Project 2: Bottle Rocket Trajectory
% by:               [Shane Billingsley]
% SID:              [110231742]
% date created:     [11/11/22]
% last modified:    [11/16/22]
%
% PURPOSE: 
% The purpose of this script is to integrate the trajectory of a water
% bottle rocket, using Newton's Laws of Motion, and equations governing the
% pressure and volume of air within the rocket.
%
% To accomplish this, the script defines a function to feed into ode45 for
% integration, and then plots the integrated data vs. a given verification
% case.
% 
% INPUTS:  
% The code requires a verification case for comparison.  All other input
% values are set using the getConst function.
% OUTPUTS:
% The code outputs plots of an integrated bottle rocket trajectory, defined
% in terms of position and velocity in the x and z directions.  Rocket
% thrust vs. time is also plotted.
% ASSUMPTIONS:
% We assume that atmospheric conditions at launch can be treated as
% constant (i.e. the rocket does not go high enough for these values to
% change.)
% We assume that forces in the y-direction are negligible for this
% calculation.
% We assume that the drag coefficient of the rocket is constant (i.e. it
% does not change with orientation of the rocket.)
% We assume that the expansion of air in the rocket, and its escape through
% the throat, is isentropic.


% housekeeping
clc;
clear all;

% import comparison data
load ("project2verification.mat");

%define initial conditions for integration
const = getConst(); %define constants for main script
tspan = [0 5];      %set time span for integration
IC = [const.p0;const.v0;const.V0;const.m_water;const.m_air]; %set initial conditions
%state vector contains 9 variables [position(x,y,z),velocity(x,y,z),air
%volume, water mass, air mass]
opts = odeset('RelTol',1e-6,'AbsTol',1e-9);  %set tolerances for ode45

%integrate trajectory using ode45, drumroll please
[t,y] = ode45(@(t,X) rocketEOM(t,X),tspan,IC,opts);

% extract additional data from rocketEOM function
% most importantly thrust, but also other values for debugging purposes
data = zeros(length(t),4);
for i = 1:length(t)
    [~,data(i,:)]=rocketEOM(t(i),y(i,:));
end

%% plot results vs. verification case
figure(1);                                  % plot x-position
hold on; grid on;
plot(t,y(:,1),"LineWidth",2);       
scatter(verification.time,verification.distance,5,"red","filled","o");
title ("Bottle Rocket Trajectory (X)");
xlabel ("Time (s)");
ylabel ("X-Position (m)");
legend ("My Data","Verification");
hold off;

% figure(2);                                % plot y-position
% hold on; grid on;
% plot(t,y(:,2),"LineWidth",2);       
% title ("Bottle Rocket Trajectory (Y)");
% xlabel ("Time (s)");
% ylabel ("Y-Position (m)");
% hold off;

figure(3);                                  % plot z-position
hold on; grid on;
plot(t,y(:,3),"LineWidth",2);       
scatter(verification.time,verification.height,5,"red","filled","o");
title ("Bottle Rocket Trajectory (Z)");
xlabel ("Time (s)");
ylabel ("Z-Position (m)");
xlim([0 4]);
legend ("My Data","Verification");
hold off;

figure(4);                                  % plot x-velocity
hold on; grid on;
plot(t,y(:,4),"LineWidth",2);       
scatter(verification.time,verification.xVelocity,5,"red","filled","o");
title ("Bottle Rocket Velocity (X)");
xlabel ("Time (s)");
ylabel ("X-Velocity (m/s)");
xlim([0 4]);
legend ("My Data","Verification");
hold off;

% figure(5);                                % plot y-velocity
% hold on; grid on;
% plot(t,y(:,5),"LineWidth",2);       
% title ("Bottle Rocket Velocity (Y)");
% xlabel ("Time (s)");
% ylabel ("Y-Velocity (m/s)");
% hold off;

figure(6);                                  % plot z-velocity
hold on; grid on;
plot(t,y(:,6),"LineWidth",2);       
scatter(verification.time,verification.zVelocity,5,"red","filled","o");
title ("Bottle Rocket Velocity (Z)");
xlabel ("Time (s)");
ylabel ("Z-Velocity (m/s)");
xlim([0 4]);
legend ("My Data","Verification");
hold off;

figure(7);                                  % plot air volume
hold on; grid on;
plot(t,y(:,7),"LineWidth",2);       
scatter(verification.time,verification.airVolume,5,"red","filled","o");
title ("Bottle Rocket Air Volume (m^3)");
xlabel ("Time (s)");
ylabel ("Volume (kg/m^3)");
xlim([0 0.3]);
legend ("My Data","Verification");
hold off;

figure(9);                                  % plot thrust
hold on; grid on;
plot(t,data(:,1),"LineWidth",2);       
scatter(verification.time,verification.thrust,5,"red","filled","o");
title ("Bottle Rocket Thrust");
xlabel ("Time (s)");
ylabel ("Thrust (N)");
xlim([0 0.3]);
legend ("My Data","Verification");
hold off;

% figure(10);                                 % plot pressure
% hold on; grid on;
% scatter(t,data(:,2),5,"red","filled","o");       
% title ("Bottle Rocket Air Pressure");
% xlabel ("Time (s)");
% ylabel ("Pressure (Pa)");
% xlim([0 0.3]);
% hold off;

%output final comparison values to the command window
disp("Max Altitude (My Data)");
disp(max(y(:,3)));
disp("Max Altitude (Verification)");
disp(max(verification.height))
disp ("Max Distance (My Data)");
disp (max(y(:,1)));
disp ("Max Distance (Verification)");
disp (max(verification.distance));

%% Subfunction rocketEOM. This is the subfunction called by ODE45. 
function [dX,data] = rocketEOM(t,X)
% 
% Inputs:   t = anonymous time variable
%           X = anonymous state vector containing
%             = [p_x;p_y;p_z;v_x;v_y;v_z;air volume;mass of water, mass of air]
%                
% Outputs: dX = derivative state vector containing
%             = [dp/dx;dp/dy;dp/dz;dv/dx;dv/dy;dv/dz;dV/dt;dm_w/dt;dm_a/dt]
%
% Methodology: function used for integrating the flight of a water bottle
% rocket
%

% Extract state vector
p = [X(1);X(2);X(3)];   % From the variable X coming in, extract the indices 
                        % corresponding to position
v = [X(4);X(5);X(6)];   % From the variable X coming in, extract the indices 
                        % corresponding to velocity
V = X(7);   % Extract the index corresponding to volume of air
m_w = X(8);   % Extract the index corresponding to mass of water
m_a = X(9);   % Extract the index corresponding to mass of air


const = getConst();     %define constants within the function

% set heading vector and adjust for wind
v_rel_vec = v-const.w0;
v_rel_mag = norm(v_rel_vec);
if norm(p) <= const.Ls          %rocket still on launch stand
    h = const.h0;
else
    h = v_rel_vec/v_rel_mag;    %heading vector free to change      %EQ 2
end

%determine air pressure at two different phases of flight
if V <= const.V     % before water is exhausted
    P = const.P0*((const.V0/V)^const.gamma);                        %EQ 5
else                % after water is exhausted
    P = const.P_end*((m_a)/const.m_air)^const.gamma;                %EQ 16
end

% Determine the phase of flight of the system to write the proper equations of motion 
% using if statements to check the relevant state variables

if V <= const.V  % check that volume of air is less than volume of the
                  % bottle rocket
    % phase 1: expelling water

    % Calculate forces for Newton's Second Law
    fGrav = [0;0;-((m_w+m_a+const.m_dry)*const.g0)];                %EQ 1
    fThrust = h*(2*const.C_dis*const.At*(P-const.Pa));              %EQ 9
    fDrag = -h*(0.5*const.Ac*const.C_drag*const.rho_air*(v_rel_mag^2)); %EQ 4
    % define change in mass
    dm_wdt = -(const.C_dis*const.At*sqrt(2*const.rho_water*(P-const.Pa))); %EQ 6
    dm_adt = 0;
    % define change in volume
    dVdt = const.C_dis*const.At*...                                 %EQ 10
        sqrt((2/const.rho_water)*(const.P0*((const.V0/V)^const.gamma)-const.Pa));
    % define values for debugging purposes
    M_e = 0;
    flag = 10;

elseif P >= const.Pa % check that air pressure is greater than ambient
                     % air pressure
    % phase 2: expelling air
  
    % Calculate forces for Newton's Second Law
    fGrav = [0;0;-((m_w+m_a+const.m_dry)*const.g0)];                %EQ 1
    fDrag = -h*(0.5*const.Ac*const.C_drag*const.rho_air*(v_rel_mag^2)); %EQ 4

    %define critical pressure
    P_crit = P*((2/(const.gamma+1))^(const.gamma/(const.gamma-1))); %EQ 17
    % Check for choked flow through the throat
    if P_crit > const.Pa     %choked flow
        rho = m_a/const.V;  %find current air density in bottle     %EQ 18
        T = P/(rho*const.R_air);    %find current temperature in bottle %EQ 18
        P_e = P_crit;    %define pressure at the exit               %EQ 18
        M_e = 1;         %define Mach number at the exit
        T_e = (2/(const.gamma+1)*T); %define temperature at the exit    %EQ 18
        rho_e = P_e/(const.R_air*T_e);  %define density at the exit %EQ 18
        V_e = M_e*sqrt(const.gamma*const.R_air*T_e); %define exit velocity %EQ 18
        % define values for debugging purposes
        flag = 21;

    else                    %not choked flow
        rho = m_a/const.V;  %find current air density in bottle     %EQ 19
        T = P/(rho*const.R_air);    %find current temperature in bottle %EQ 19
        P_e = const.Pa;    %define pressure at the exit             %EQ 19
                           %define Mach number at the exit
        M_e = sqrt((((P/const.Pa)^((const.gamma-1)/const.gamma))-1)*...
            (2/(const.gamma-1)));                                   %EQ 19
                           %define temperature at the exit
        T_e = T/((((const.gamma-1)/2)*M_e^2)+1);                    %EQ 19
        rho_e = const.Pa/(const.R_air*T_e);  %define density at the exit %EQ 19
        V_e = M_e*sqrt(const.gamma*const.R_air*T_e); %define exit velocity %EQ 19
        % define values for debugging purposes
        flag = 22;
    end
    % define change in mass
    dm_adt = -const.C_dis*rho_e*const.At*V_e;                        %EQ 21
    dm_wdt = 0;

    fThrust = h*(((-dm_adt)*V_e)+((P_e-const.Pa)*const.At));        %EQ 20

    % define change in volume
    dVdt = 0;

elseif p(3) >= 0   % check that the rocket is above the ground 
    % phase 3: ballistic phase

    % Calculate forces for Newton's Second Law
    fGrav = [0;0;-((m_w+m_a+const.m_dry)*const.g0)];                %EQ 1
    fThrust = [0;0;0];
    fDrag = -h*(0.5*const.Ac*const.C_drag*const.rho_air*(v_rel_mag^2)); %EQ 4
    
    % define change in mass
    dm_wdt = 0;
    dm_adt = 0;

    % define change in volume
    dVdt = 0;
    
    % define values for debugging purposes
    M_e = 0;
    flag = 30;

else                % after rocket has landed, stop any changes
    fThrust = [0;0;0];
    fGrav = [0;0;0];
    fDrag = [0;0;0];
    v = [0;0;0];
    dm_adt = 0;
    dm_wdt = 0;
    dVdt = 0;
    M_e = 0;
    flag = 40;
end

% expression for net force and acceleration per Newton's Second Law
fnet = fThrust + fGrav + fDrag;                                  %EQ 1
%forces are signed properly in previous steps

a = fnet/(m_a+m_w+const.m_dry); % calculate acceleration

dX = [v;a;dVdt;dm_wdt;dm_adt]; %create output derivative vector using changed variables
data = [norm(fThrust),P,M_e,flag]; %output thrust data and debugging values
end
%% Subfunction getConst which sets up the constants needed to solve this problem. 
function const = getConst()
% 
% Inputs:  N/A
%                
% Outputs: const = structure containing initial conditions, physical
% constants, given rocket characteristics, and other values not changing
% with time.
%
% Methodology: function used to define a constant structure for ode45 integration
% 

% initial conditions
const.p0 = [0;0;0.25]; % initial position vector (m)
const.v0 = [0;0;0]; % initial velocity vector (m/s)
const.w0 = [0;0;0]; % initial wind vector (m/s)
const.h0 = [sqrt(2)/2;0;sqrt(2)/2]; % initial heading vector (m)
const.T0 =  300; % initial temperature (K)
const.P0 = 344642.86+83403.57; % gage pressure+ambient pressure (Pa) (N/m^2)
const.Vw = 0.001; % initial volume of water (m^3)
const.Ls = 0.5; % length of launch stand (m)

% properties of the bottle rocket
const.m_dry =  0.15; % dry mass of bottle rocket (kg)
const.d =  0.105; % diameter of the bottle rocket (m)
const.d_t = 0.021; % diameter of the rocket throat (m)
const.V = 0.002; % volume of empty bottle rocket (m^3)
const.C_dis = 0.8; % discharge coefficient of the rocket
const.C_drag = 0.5; % drag coefficient of the rocket

% physical constants
const.g0 = 9.81; % gravitational acceleration (m/s^2)
const.Pa = 83403.57; % ambient air pressure at launch altitude (Pa) (N/m^2)
const.rho_air = 0.961; % density of ambient air at launch altitude (kg/m^3)
const.rho_water = 1000; % density of water (kg/m^3)
const.gamma = 1.4; % ratio of specific heats for air
const.R_air = 287; % R-value for air (J/kg*K)

% some derived properties
const.V0 = const.V-const.Vw; %initial volume of air
const.m_air = ...   % initial mass of air in the bottle rocket (kg)
    ((const.P0)*const.V0)/(const.R_air*const.T0);
const.m_water = ... % initial mass of water in the bottle rocket (kg)
    (const.rho_water*const.Vw);
const.m_wet = ...   % initial wet mass of the bottle rocket (kg)
    const.m_dry + const.m_air + const.m_water;                      %EQ 12
const.P_end = ...   % air pressure when water is exhausted (Pa) (N/m^2)
    const.P0*((const.V0/const.V)^const.gamma);                      %EQ 14
const.T_end = ...   % air temperature when water is exhausted (K)
    const.T0*((const.V0/const.V)^(const.gamma-1));                  %EQ 15
const.Ac = pi * const.d^2 * (1/4);  % cross-sectional area of rocket (m^2)
const.At = pi * const.d_t^2 * (1/4); %cross-sectional area of the throat (m^2)

end
##### SOURCE END #####
--></body></html>